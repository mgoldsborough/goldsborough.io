---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const posts = await getCollection('posts');

// Sort posts by date descending
posts.sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

// Group posts by year
const postsByYear = posts.reduce((acc, post) => {
  const year = post.data.date.getFullYear();
  if (!acc[year]) acc[year] = [];
  acc[year].push(post);
  return acc;
}, {} as Record<number, typeof posts>);

const years = Object.keys(postsByYear).map(Number).sort((a, b) => b - a);
---

<BaseLayout
  title="Archive | Mathew Goldsborough"
  description="All blog posts from Mathew Goldsborough, archived by year."
  og={{ website: true }}
>
  <section class="page-hero">
    <h1 class="hero-title animate-in">Archive</h1>
    <div class="hero-accent animate-in animate-in-delay-1"></div>
  </section>

  <section class="archive-list animate-in animate-in-delay-2">
    {years.map((year) => (
      <div class="year-group">
        <span class="year-label">{year}</span>
        <ul class="post-list">
          {postsByYear[year].map((post) => (
            <li>
              <a href={`/${post.id}`}>{post.data.title}</a>
            </li>
          ))}
        </ul>
      </div>
    ))}
  </section>
</BaseLayout>

<style>
  .archive-list {
    padding-bottom: var(--space-xl);
  }

  .year-group {
    display: grid;
    grid-template-columns: 4rem 1fr;
    gap: var(--space-md);
    margin-bottom: var(--space-lg);
  }

  @media (max-width: 480px) {
    .year-group {
      grid-template-columns: 1fr;
      gap: var(--space-sm);
    }
  }

  .year-label {
    font-size: 0.8rem;
    font-weight: 500;
    color: var(--text-muted);
    padding-top: var(--space-xs);
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-list li {
    margin: 0;
  }

  .post-list a {
    display: block;
    padding: var(--space-xs) 0;
    color: var(--text-primary);
    text-decoration: none;
    font-size: 1rem;
    line-height: 1.4;
    transition: color var(--transition-fast), padding-left var(--transition-fast);
  }

  .post-list a:hover {
    color: var(--accent-primary);
    padding-left: var(--space-sm);
  }
</style>
